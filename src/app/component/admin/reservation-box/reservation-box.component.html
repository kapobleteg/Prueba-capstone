<p-table [value]="(reservations$ | async) || []" [paginator]="true" [rows]="5" [tableStyle]="{ 'min-width': '80rem' }"
    [rowsPerPageOptions]="[5, 10, 20]">
    <ng-template pTemplate="header">
        <tr>
            <th style="width:10%">Usuario</th>
            <th style="width:15%">Box</th>
            <th style="width:15%">Inicio</th>
            <th style="width:15%">Fin</th>
            <th style="width:10%">Estado</th>
            <th style="width:15%">Monto</th>
            <th style="width:15%">Fecha de Pago</th>
            <th style="width:10%">Estado de Pago</th>
            <th></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-reservation>
        <tr>
            <td>{{ reservation.user.name }}</td>
            <td>{{ reservation.box.name }}</td>
            <td>{{ reservation.startDate | date: 'short' }}</td>
            <td>{{ reservation.endDate | date: 'short' }}</td>
            <td>{{ reservation.status ? 'Activo' : 'Inactivo' }}</td>
            <td>{{ reservation.paymentReceipt?.amount | currency:'USD':'symbol':'1.0-0' }}</td>
            <td>{{ reservation.paymentReceipt?.date | date: 'short' }}</td>
            <td>{{ reservation.status | reservationStatus }}</td>
            <td>
                <p-button label="Revisar" icon="pi pi-eye" (click)="openDialog(reservation)" [disabled]="reservation.status != 'PENDING'">
                </p-button>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-dialog header="RevisiÃ³n de Reserva" [modal]="true" [(visible)]="showDialog" closable="true"
    [style]="{ width: '50vw' }">
    <div *ngIf="selectedReservation">
        <h3>Detalles de la Reserva</h3>
        <p><b>Usuario:</b> {{ selectedReservation.user.name }}</p>
        <p><b>Box:</b> {{ selectedReservation.box.name }}</p>
        <p><b>Inicio:</b> {{ selectedReservation.startDate | date: 'short' }}</p>
        <p><b>Fin:</b> {{ selectedReservation.endDate | date: 'short' }}</p>
        <p><b>Monto:</b> {{ selectedReservation.receipt?.amount | currency }}</p>
        <p><b>Fecha de Pago:</b> {{ selectedReservation.receipt?.date | date: 'short' }}</p>
        <p><b>Estado de Pago:</b> {{ selectedReservation.receipt?.status ? 'Pagado' : 'Pendiente' }}</p>
        <h3>Comprobante de Pago</h3>
        <img [src]="getImageSrc(selectedReservation.paymentReceipt?.attached)" alt="Comprobante de Pago"
            style="width: 100%; max-height: 300px; object-fit: cover; margin-bottom: 1rem;"
            (click)="showImageDialog = true" />

        <div class="p-d-flex p-jc-between">
            <p-button label="Aceptar" icon="pi pi-check" class="p-button-success"
                (click)="acceptReservation(selectedReservation)">
            </p-button>
            <p-button label="Rechazar" icon="pi pi-times" class="p-button-danger"
                (click)="rejectReservation(selectedReservation)">
            </p-button>
        </div>
    </div>
</p-dialog>

<p-dialog header="Imagen Ampliada" [(visible)]="showImageDialog" [modal]="true"
    [style]="{ width: '80vw', height: '80vh' }" [closable]="true">
    <img [src]="getImageSrc(selectedReservation?.paymentReceipt?.attached)" alt="Comprobante Ampliado"
        style="width: 100%; height: 100%; object-fit: contain;" />
</p-dialog>