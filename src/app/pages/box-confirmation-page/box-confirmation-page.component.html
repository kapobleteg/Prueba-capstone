<p-toast></p-toast>
<div class="box-confirmation-page" *ngIf="box$ | async as box">
  <h2>Confirmar Reserva del Box</h2>
  <p>Box: {{ box.name }}</p>
  <p>Piso: {{ box.location }}</p>
  <p>Duración del servicio: {{ box.time }}H</p>
  <p>Precio: ${{ box.price }}</p>

  <div class="card flex justify-content-center" *ngIf="(bankInfo$ | async) as bankInfo">
    <p-accordion>
      <p-accordionTab header="Datos de transferencia">
        <div class="p-fluid">
          <div class="p-field">
            <label>Nombre del destinatario: {{ bankInfo.name }}</label>
          </div>
          <div class="p-field">
            <label>RUT del destinatario: {{ bankInfo.rut }}</label>
          </div>
          <div class="p-field">
            <label>Banco: {{ bankInfo.bank }}</label>
          </div>
          <div class="p-field">
            <label>Tipo de cuenta: {{ bankInfo.accountType }}</label>
          </div>
          <div class="p-field">
            <label>Número de cuenta: {{ bankInfo.accountNumber }}</label>
          </div>
          <div class="p-field">
            <label>Monto a transferir (CLP): {{ box.price | currency: 'CLP' }}</label>
          </div>
          <div class="p-field">
            <label>Motivo de la transferencia: {{ bankInfo.reasonTransfer }}</label>
          </div>
        </div>
      </p-accordionTab>
    </p-accordion>
  </div>

  <form [formGroup]="confirmationForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="name">Nombre</label>
      <input id="name" formControlName="name" type="text" placeholder="Ingresa tu nombre" />
    </div>

    <div class="form-group">
      <label for="email">Correo</label>
      <input id="email" formControlName="email" type="email" placeholder="Ingresa tu correo" />
    </div>

    <div class="form-group">
      <label for="phone">Número de teléfono</label>
      <input id="phone" formControlName="phone" type="text" placeholder="Ingresa tu número de teléfono" />
    </div>

    <div class="form-group">
      <label for="reservationDate">Selecciona la Fecha y Hora</label>
      <p-calendar id="reservationDate" formControlName="reservationDate" [showTime]="true" [hourFormat]="'24'"
        [minDate]="minDate" (onSelect)="onDateSelect($event)">
      </p-calendar>
    </div>
    <div class="form-group">
      <label for="specialty">Especialidad</label>
      <input id="specialty" formControlName="specialty" type="text" placeholder="Ingresa tu especialidad" />
    </div>

    <div class="form-group">
      <label for="certifications">Certificados</label>
      <textarea id="certifications" formControlName="certifications"
        placeholder="Ingresa tus certificados separados por comas"></textarea>
    </div>
    
    <div class="form-group">
      <label>Sube el comprobante de pago:</label>

      <p-fileUpload
      mode="basic"
      chooseLabel="Subir comprobante"
      chooseIcon="pi pi-upload"
      name="demo[]"
      url="/api/cdn/api/upload.php" 
      accept="image/*"
      maxFileSize="1000000"
      (onUpload)="onFileSelected($event)"
    ></p-fileUpload>
    </div>

    <button type="submit" [disabled]="!confirmationForm.valid || loading" pButton>
      <ng-container *ngIf="!loading; else loadingTemplate">
        Confirmar Reserva
      </ng-container>
      <ng-template #loadingTemplate>
        <i class="pi pi-spin pi-spinner"></i> Cargando...
      </ng-template>
    </button>

  </form>
</div>